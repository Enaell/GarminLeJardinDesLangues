# Guide de D√©veloppement - Le Jardin des Langues

## üìã Table des Mati√®res
1. [Architecture](#architecture)
2. [Composants Principaux](#composants-principaux)
3. [Flux de Donn√©es](#flux-de-donn√©es)
4. [Persistance des Donn√©es](#persistance-des-donn√©es)
5. [Personnalisation](#personnalisation)
6. [Optimisation](#optimisation)
7. [D√©bogage](#d√©bogage)

## üèóÔ∏è Architecture

### Vue d'Ensemble
L'application suit le pattern MVC (Model-View-Controller) adapt√© √† Monkey C :
- **Model** : `QuizModel.mc` + `VocabularyData.mc` + `WordProgressStorage.mc`
- **View** : `MenuView.mc` + `LanguageView.mc` + `DictionaryView.mc` + `WordDetailView.mc`
- **Controller** : `MenuDelegate.mc` + `LanguageDelegate.mc` + `DictionaryDelegate.mc` + `WordDetailDelegate.mc`

### Diagramme de Flux
```
LanguageApp (entry point)
    ‚Üì
    ‚îú‚îÄ‚Üí MenuView (√©cran d'accueil)
    ‚îÇ       ‚Üì
    ‚îÇ   MenuDelegate (interactions menu)
    ‚îÇ       ‚Üì
    ‚îÇ   [S√©lection mode]
    ‚îÇ       ‚Üì
    ‚îÇ   ‚îú‚îÄ‚Üí Quiz Normal/Invers√©
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   LanguageView (affichage quiz)
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   QuizModel (logique + mode)
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   VocabularyData (donn√©es)
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   WordProgressStorage (persistance)
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   LanguageDelegate (interactions quiz)
    ‚îÇ   ‚îÇ       ‚Üì
    ‚îÇ   ‚îÇ   [Feedback ‚Üí Flaggage]
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚Üí Dictionnaire
    ‚îÇ           ‚Üì
    ‚îÇ       DictionaryView (liste des mots)
    ‚îÇ           ‚Üì
    ‚îÇ       DictionaryDelegate (interactions)
    ‚îÇ           ‚Üì
    ‚îÇ       [S√©lection d'un mot]
    ‚îÇ           ‚Üì
    ‚îÇ       WordDetailView (d√©tails + √©dition statut)
    ‚îÇ           ‚Üì
    ‚îÇ       WordDetailDelegate (interactions)
    ‚îÇ           ‚Üì
    ‚îÇ       VocabularyData + WordProgressStorage (sauvegarde)
```

## üîß Composants Principaux

### 0. MenuView.mc & MenuDelegate.mc (v1.1+, v1.4+)
**R√¥le** : √âcran d'accueil pour choisir le mode de quiz ou acc√©der au dictionnaire

**MenuView - Structure** :
```monkeyc
private var selectedOption    // 0 = Normal, 1 = Invers√©, 2 = Dictionnaire
private var screenHeight      // Pour calcul zones tactiles
enum MenuOption {
    QUIZ_NORMAL = 0,
    QUIZ_REVERSE = 1,
    DICTIONARY = 2
}
```

**M√©thodes principales** :
- `onUpdate(dc)` : Dessine le menu avec 3 options (v1.4+)
- `drawMenuOption()` : Dessine une option (titre + description)
- `selectPreviousOption/NextOption()` : Navigation UP/DOWN (3 options, v1.4+)
- `handleTapAt(y)` : G√®re les clics tactiles (3 zones, v1.4+)
- `launchSelectedMode()` : Lance le quiz ou le dictionnaire selon l'option s√©lectionn√©e (v1.4+)

**MenuDelegate - Interactions** :
- `onTap(clickEvent)` : Capture les clics tactiles
- `onKey()` : G√®re UP/DOWN/SELECT
- `onSelect()` : Lance le mode s√©lectionn√©
- `onBack()` : Quitte l'application (comportement par d√©faut)

### 0bis. DictionaryView.mc & DictionaryDelegate.mc (v1.4+)
**R√¥le** : Affiche la liste compl√®te des mots avec filtrage par statut

**DictionaryView - Structure** :
```monkeyc
private var scrollOffset          // Index du premier mot visible
private var selectedIndex         // Index du mot s√©lectionn√© dans la liste filtr√©e
private var visibleItems          // Nombre de mots affich√©s simultan√©ment (4)
private var filterStatus          // Filtre actuel (null = tous, 0/1/2 = Ma√Ætris√©/Connu/Inconnu)
private var filteredIndices       // Liste des indices de mots correspondant au filtre
```

**M√©thodes principales** :
- `onUpdate(dc)` : Dessine la liste des mots avec statuts
- `drawWordItem()` : Dessine une ligne de la liste (hanzi, traduction, ic√¥ne de statut)
- `drawScrollIndicator()` : Affiche l'indicateur de scroll si n√©cessaire
- `selectPreviousWord/NextWord()` : Navigation dans la liste avec scroll automatique
- `cycleFilter()` : Change le filtre (Tous ‚Üí Ma√Ætris√©s ‚Üí Connus ‚Üí Inconnus ‚Üí Tous)
- `updateFilteredIndices()` : Met √† jour la liste des mots selon le filtre actif
- `openWordDetail()` : Ouvre la vue d√©taill√©e du mot s√©lectionn√©
- `getStatusIcon/Color()` : Rendu visuel des statuts (‚úì/‚óã/‚úó + couleurs)

**DictionaryDelegate - Interactions** :
- `onTap(clickEvent)` : Ouvre les d√©tails du mot s√©lectionn√©
- `onKey()` : G√®re UP/DOWN/SELECT
- `onPreviousPage/NextPage()` : Navigation dans la liste
- `onSelect()` : Ouvre les d√©tails
- `onMenu()` : Change le filtre (cycle entre les 4 modes)
- `onBack()` : Retour au menu principal

**Fonctionnalit√©s** :
- Affichage de tous les mots (300 par d√©faut)
- Filtrage par statut : Ma√Ætris√©s, Connus, Inconnus, ou Tous
- Scroll automatique avec indicateur visuel
- Affichage du compteur (ex: "15/300 mots", "Ma√Ætris√©s (42)")
- Navigation rapide avec les boutons physiques ou l'√©cran tactile

### 0ter. WordDetailView.mc & WordDetailDelegate.mc (v1.4+)
**R√¥le** : Affiche les d√©tails complets d'un mot et permet de modifier son statut

**WordDetailView - Structure** :
```monkeyc
private var wordIndex              // Index du mot affich√©
private var currentStatus          // Statut actuel du mot
private var editMode               // Mode √©dition activ√© (true/false)
private var selectedStatusOption   // Option s√©lectionn√©e en mode √©dition (0-2)
```

**Modes d'affichage** :
1. **Mode D√©tail** (consultation) :
   - Affichage grand format du hanzi
   - Pinyin
   - Traduction compl√®te
   - Niveau HSK
   - Statut actuel avec ic√¥ne et couleur

2. **Mode √âdition** (modification du statut) :
   - 3 options interactives :
     - ‚úì Ma√Ætris√© (vert)
     - ‚óã Connu (orange)
     - ‚úó Inconnu (rouge)
   - Navigation UP/DOWN
   - Validation ou annulation

**M√©thodes principales** :
- `onUpdate(dc)` : Dessine le bon mode (d√©tail ou √©dition)
- `drawDetailMode(dc)` : Affichage consultation
- `drawEditMode(dc)` : Affichage √©dition
- `drawStatusOption()` : Dessine une option de statut s√©lectionnable
- `enterEditMode()` : Active le mode √©dition
- `cancelEditMode()` : Annule les modifications
- `saveStatus()` : Enregistre le nouveau statut et quitte le mode √©dition
- `selectPreviousStatusOption/NextStatusOption()` : Navigation entre les 3 options
- `getStatusText/Icon/Color()` : Rendu visuel des statuts

**WordDetailDelegate - Interactions** :
- `onTap()` : Mode d√©tail = entre en √©dition si clic sur zone Statut (72%-90%) / Mode √©dition = s√©lectionne et sauvegarde l'option cliqu√©e
- `onKey()` : G√®re UP/DOWN/SELECT selon le mode
- `onSelect()` : Mode d√©tail = entre en √©dition / Mode √©dition = sauvegarde
- `onBack()` : Mode √©dition = annule / Mode d√©tail = retour au dictionnaire
- `onPreviousPage/NextPage()` : Navigation en mode √©dition uniquement

**Workflow de modification** :
```
1. Utilisateur ouvre un mot depuis le dictionnaire
2. WordDetailView affiche les infos compl√®tes
3. Utilisateur appuie sur SELECT ou tape sur la zone "Statut" (72%-90% de l'√©cran)
4. Mode √©dition s'active avec 3 options
5. Utilisateur s√©lectionne un nouveau statut (UP/DOWN ou clic direct)
6. Appuie sur SELECT ou tape sur une option pour valider
7. Le statut est sauvegard√© dans WordProgressStorage
8. Retour au mode d√©tail avec le nouveau statut

Note : Un clic direct sur une option (35%-52%, 52%-69%, 69%-86%) s√©lectionne et sauvegarde imm√©diatement.
```

### 1. VocabularyData.mc
**R√¥le** : Stockage et acc√®s aux donn√©es de vocabulaire

**Structure des donn√©es** :
```monkeyc
[hanzi, pinyin, traduction, hskLevel]
// Exemple: ["‰Ω†Â•Ω", "n«ê h«éo", "bonjour", 1]
```

**M√©thodes cl√©s** :
- `getVocabularySize()` : Retourne le nombre total de mots (300)
- `getWordByIndex(index)` : R√©cup√®re un mot complet
- `getHanzi(index)` : R√©cup√®re uniquement le hanzi
- `getPinyin(index)` : R√©cup√®re uniquement le pinyin
- `getTranslation(index)` : R√©cup√®re uniquement la traduction
- `getHskLevel(index)` : R√©cup√®re le niveau HSK
- `setWordStatus(index, status)` : D√©finit le statut de ma√Ætrise d'un mot (v1.3+)
- `getWordStatus(index)` : R√©cup√®re le statut de ma√Ætrise d'un mot (v1.3+)
- `getProgressStatistics()` : R√©cup√®re les statistiques de progression (v1.3+)

**Ajout de nouveaux mots** :
```monkeyc
// Ajouter √† la fin du tableau vocabulary
["Êñ∞ËØç", "xƒ´n c√≠", "nouveau mot", 2],
```

### 2. QuizModel.mc
**R√¥le** : Gestion de la logique du quiz

**Modes de quiz (v1.1+)** :
```monkeyc
enum {
    MODE_NORMAL = 0,   // Hanzi ‚Üí Fran√ßais
    MODE_REVERSE = 1   // Fran√ßais ‚Üí Hanzi
}
```

**Variables d'√©tat** :
```monkeyc
// Variable statique pour conserver l'√©tat du pinyin entre les sessions
static private var showPinyin as Boolean = true;

private var quizMode             // Mode actuel (NORMAL/REVERSE)
private var currentWordIndex      // Index du mot actuel
private var options               // Array des 4 options de r√©ponse
private var correctAnswerPosition // Position de la bonne r√©ponse (0-3)
private var usedIndices          // Historique des mots utilis√©s
private var score                // Nombre de bonnes r√©ponses
private var totalQuestions       // Nombre total de questions
```

**Algorithme de g√©n√©ration des questions** :
```
1. S√©lectionner un mot al√©atoire (√©viter les 20 derniers)
2. MODE_NORMAL: Ajouter la traduction fran√ßaise aux options
   MODE_REVERSE: Ajouter le hanzi aux options
3. G√©n√©rer 3 distracteurs selon le mode
4. M√©langer les 4 options (algorithme Fisher-Yates)
5. M√©moriser la position de la bonne r√©ponse
```

**M√©thodes principales** :
- `initialize(mode)` : Constructeur avec mode de quiz (v1.1+)
- `generateNewQuestion()` : Cr√©e une nouvelle question
- `generateOptions()` : G√©n√®re les 4 options selon le mode
- `checkAnswer(position)` : V√©rifie si la r√©ponse est correcte
- `getCurrentHanzi()` : R√©cup√®re le hanzi √† afficher
- `getCurrentPinyin()` : R√©cup√®re le pinyin
- `getCorrectTranslation()` : R√©cup√®re la traduction correcte
- `getOptions()` : R√©cup√®re les 4 options de r√©ponse
- `getScore()` : R√©cup√®re le score actuel
- `getQuizMode()` : Retourne le mode actuel (v1.1+)
- `getCorrectAnswerPosition()` : Retourne la position de la bonne r√©ponse (0-3)
- `togglePinyin()` : Bascule l'affichage du pinyin (v1.2+)
- `isPinyinVisible()` : Retourne l'√©tat actuel du pinyin (v1.2+)
- `showPinyinDisplay()` : Active l'affichage du pinyin (v1.2+)
- `hidePinyinDisplay()` : D√©sactive l'affichage du pinyin (v1.2+)
- `setCurrentWordStatus(status)` : Enregistre le statut du mot actuel (v1.3+)
- `getCurrentWordStatus()` : R√©cup√®re le statut du mot actuel (v1.3+)
- `getCurrentWordIndex()` : Retourne l'index du mot actuel (v1.3+)

### 2bis. WordProgressStorage.mc (v1.3+)
**R√¥le** : Gestion de la persistance des statuts de ma√Ætrise des mots

**Statuts possibles** :
```monkeyc
enum {
    STATUS_MASTERED = 0,   // ‚úì Mot ma√Ætris√©
    STATUS_KNOWN = 1,      // ‚óã Mot connu
    STATUS_UNKNOWN = 2     // ‚úó Mot inconnu
}
```

**Stockage** :
- Utilise le Storage API de Garmin Connect IQ
- Cl√© : `"word_progress"`
- Format : Dictionary<String, Number> (index ‚Üí statut)
- Persistant entre les sessions

**M√©thodes principales** :
- `setWordStatus(index, status)` : Enregistre le statut d'un mot
- `getWordStatus(index)` : R√©cup√®re le statut d'un mot (retourne STATUS_UNKNOWN par d√©faut)
- `hasStatus(index)` : V√©rifie si un mot a d√©j√† √©t√© √©valu√©
- `getStatistics()` : Retourne les statistiques (nombre de mots par statut)
- `getEvaluatedWordsCount()` : Nombre total de mots √©valu√©s
- `getMasteredPercentage()` : Pourcentage de mots ma√Ætris√©s
- `resetAllProgress()` : R√©initialise toutes les donn√©es (efface tout)

**Exemple d'utilisation** :
```monkeyc
// Enregistrer qu'un mot est ma√Ætris√©
WordProgressStorage.setWordStatus(42, WordProgressStorage.STATUS_MASTERED);

// R√©cup√©rer le statut
var status = WordProgressStorage.getWordStatus(42);
if (status == WordProgressStorage.STATUS_MASTERED) {
    System.println("Ce mot est ma√Ætris√© !");
}

// Obtenir les statistiques
var stats = WordProgressStorage.getStatistics();
System.println("Ma√Ætris√©s: " + stats["mastered"]);
System.println("Connus: " + stats["known"]);
System.println("Inconnus: " + stats["unknown"]);
```
### 3. LanguageView.mc
**R√¥le** : Affichage de l'interface utilisateur du quiz

**Variables d'√©tat** :
```monkeyc
private var quizModel        // Instance du mod√®le
private var selectedOption   // Option actuellement s√©lectionn√©e (0-3)
private var feedbackState    // √âtat du feedback (NONE/CORRECT/INCORRECT/FLAGGING) (v1.3+)
private var selectedFlag     // Option de flaggage s√©lectionn√©e (0-2) (v1.3+)
```

**√âtats du feedback (v1.3+)** :
```monkeyc
enum {
    FEEDBACK_NONE = 0,        // Pas de feedback, mode quiz normal
    FEEDBACK_CORRECT = 1,     // Feedback bonne r√©ponse
    FEEDBACK_INCORRECT = 2,   // Feedback mauvaise r√©ponse
    FEEDBACK_FLAGGING = 3     // Mode flaggage (√©valuation du mot)
}
```

**Layout de l'√©cran (Mode Normal)** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     ‚îÇ  15% - Hanzi (grand)
‚îÇ        ‰Ω†Â•Ω          ‚îÇ
‚îÇ      n«ê h«éo         ‚îÇ  28% - Pinyin (petit)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  35% - S√©parateur
‚îÇ  1. bonjour     ‚óÑ   ‚îÇ  40-52.5% - Option 1
‚îÇ  2. au revoir       ‚îÇ  52.5-65% - Option 2
‚îÇ  3. merci           ‚îÇ  65-77.5% - Option 3
‚îÇ  4. pardon          ‚îÇ  77.5-90% - Option 4
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      3/5            ‚îÇ  95% - Score
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Layout de l'√©cran (Mode Invers√© - v1.1+)** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     ‚îÇ
‚îÇ      Bonjour        ‚îÇ  15% - Fran√ßais (grand)
‚îÇ      (n«ê h«éo)       ‚îÇ  28% - Pinyin indice
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. ‰Ω†Â•Ω        ‚óÑ   ‚îÇ  40-52.5% - Option 1
‚îÇ  2. ÂÜçËßÅ            ‚îÇ  52.5-65% - Option 2
‚îÇ  3. Ë∞¢Ë∞¢            ‚îÇ  65-77.5% - Option 3
‚îÇ  4. ËØ∑              ‚îÇ  77.5-90% - Option 4
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      3/5            ‚îÇ  95% - Score
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Layout de l'√©cran de flaggage (v1.3+)** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Niveau de ma√Ætrise ?‚îÇ  10% - Titre
‚îÇ       ‰Ω†Â•Ω           ‚îÇ  22% - Mot concern√©
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  32% - S√©parateur
‚îÇ   ‚úì Ma√Ætris√©    ‚óÑ   ‚îÇ  38-55% - Option 1 (vert)
‚îÇ   ‚óã Connu           ‚îÇ  55-72% - Option 2 (orange)
‚îÇ   ‚úó Inconnu         ‚îÇ  72-89% - Option 3 (rouge)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Üë‚Üì ‚Ä¢ SELECT         ‚îÇ  93% - Instructions
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Rendu** :
- `initialize(mode)` : Constructeur avec mode de quiz (v1.1+)
- `onUpdate(dc)` : M√©thode principale de rendu (appelle la bonne m√©thode selon le mode)
- `drawNormalModeQuestion(dc)` : Dessine question Hanzi ‚Üí Fran√ßais (v1.1+, affichage conditionnel du pinyin v1.2+)
- `drawReverseModeQuestion(dc)` : Dessine question Fran√ßais ‚Üí Hanzi (v1.1+, affichage conditionnel du pinyin v1.2+)
- `drawOption(dc, index, y, width, height)` : Dessine une option
- `drawFeedback(dc)` : Dessine l'√©cran de feedback (adapt√© selon le mode, v1.3+ avec instruction pour √©valuer)
- `drawFlaggingScreen(dc)` : Dessine l'√©cran d'√©valuation du mot (v1.3+)
- `drawFlagOption(dc, index, y, width, height, label, color)` : Dessine une option de flaggage (v1.3+)
- `togglePinyin()` : Bascule l'affichage du pinyin et rafra√Æchit l'√©cran (v1.2+)

**Interactions** :
- `selectPreviousOption()` : Navigation vers l'option pr√©c√©dente (bouton UP) - g√®re aussi le flaggage (v1.3+)
- `selectNextOption()` : Navigation vers l'option suivante (bouton DOWN) - g√®re aussi le flaggage (v1.3+)
- `selectOptionByIndex(index)` : S√©lection directe d'une option (pour tactile)
- `handleTapAt(y)` : Calcule quelle option a √©t√© cliqu√©e selon position Y, ou bascule le pinyin si clic en haut (v1.2+), g√®re aussi les clics sur le flaggage (v1.3+)
- `submitAnswer()` : Valide la r√©ponse et affiche le feedback, ou passe au flaggage (v1.3+)
- `moveToFlagging()` : Passe du feedback au mode flaggage (v1.3+)
- `submitFlag()` : Enregistre le statut s√©lectionn√© et passe √† la question suivante (v1.3+)
- `nextQuestion()` : Passe √† la question suivante
- `togglePinyin()` : Bascule l'affichage du pinyin et rafra√Æchit l'√©cran (v1.2+)

**Couleurs** :
```monkeyc
// Th√®me principal
Background: Graphics.COLOR_BLACK
Text: Graphics.COLOR_WHITE
Pinyin: Graphics.COLOR_LT_GRAY

// S√©lection
Selected: Graphics.COLOR_DK_BLUE

// Feedback
Correct: Graphics.COLOR_DK_GREEN
Incorrect: Graphics.COLOR_DK_RED
```

### 4. LanguageDelegate.mc
**R√¥le** : Gestion des interactions utilisateur dans le quiz

**H√©ritage** : `WatchUi.InputDelegate` (au lieu de BehaviorDelegate pour supporter le tactile)

**Mapping des interactions** :
```monkeyc
// Boutons physiques
onKey(KEY_UP)    ‚Üí UP    ‚Üí selectPreviousOption()
onKey(KEY_DOWN)  ‚Üí DOWN  ‚Üí selectNextOption()
onKey(KEY_ENTER) ‚Üí START ‚Üí submitAnswer()
onPreviousPage() ‚Üí UP    ‚Üí selectPreviousOption() (legacy)
onNextPage()     ‚Üí DOWN  ‚Üí selectNextOption() (legacy)
onSelect()       ‚Üí START ‚Üí submitAnswer() (legacy)
onBack()         ‚Üí BACK  ‚Üí Retour au menu (v1.1+)

// √âcran tactile
onTap(clickEvent) ‚Üí TOUCH ‚Üí handleTapAt(y) ‚Üí {
    - Si y < 35% : togglePinyin() (v1.2+)
    - Si y >= 40% : S√©lection + validation directe d'une option
}
```

**M√©thodes principales** :
- `onTap(clickEvent)` : Capture les clics tactiles et calcule la position Y
- `onKey(keyEvent)` : G√®re les √©v√©nements clavier/boutons
- `onBack()` : Retourne au menu (v1.1+)
- `onPreviousPage/onNextPage/onSelect()` : M√©thodes legacy (compatibilit√©)

## üîÑ Flux de Donn√©es

### D√©marrage de l'Application
```
1. LanguageApp.initialize()
2. LanguageApp.getInitialView()
   ‚îú‚îÄ‚Üí Cr√©er MenuView (v1.1+)
   ‚îî‚îÄ‚Üí Cr√©er MenuDelegate(menuView)
3. MenuView.onShow()
4. MenuView.onUpdate(dc) ‚Üí Affichage menu
5. [Utilisateur s√©lectionne un mode]
6. MenuView.launchQuiz()
   ‚îú‚îÄ‚Üí Cr√©er LanguageView(mode)
   ‚îÇ   ‚îú‚îÄ‚Üí Cr√©er QuizModel(mode)
   ‚îÇ   ‚îî‚îÄ‚Üí generateNewQuestion()
   ‚îÇ       ‚îî‚îÄ‚Üí VocabularyData.getWordByIndex()
   ‚îî‚îÄ‚Üí Cr√©er LanguageDelegate(view)
7. LanguageView.onShow()
8. LanguageView.onUpdate(dc) ‚Üí Affichage quiz
```

### Interaction Utilisateur (Navigation)
```
1. Utilisateur appuie sur UP/DOWN
2. LanguageDelegate.onPreviousPage/onNextPage()
3. LanguageView.selectPreviousOption/selectNextOption()
4. WatchUi.requestUpdate()
5. LanguageView.onUpdate(dc) ‚Üí Redessine l'√©cran
```

### Validation d'une R√©ponse et Flaggage (v1.3+)
```
1. Utilisateur appuie sur SELECT (ou clic tactile)
2. LanguageDelegate.onSelect()
3. LanguageView.submitAnswer()
   ‚îú‚îÄ‚Üí QuizModel.checkAnswer(selectedOption)
   ‚îÇ   ‚îî‚îÄ‚Üí Retourne true/false
   ‚îî‚îÄ‚Üí Mettre feedbackState √† CORRECT/INCORRECT
4. WatchUi.requestUpdate()
5. LanguageView.onUpdate(dc) ‚Üí drawFeedback()
   ‚îî‚îÄ‚Üí Affiche "Appuyez pour √©valuer"
6. [Utilisateur appuie √† nouveau sur SELECT]
7. LanguageView.moveToFlagging()
   ‚îî‚îÄ‚Üí feedbackState = FEEDBACK_FLAGGING
8. WatchUi.requestUpdate()
9. LanguageView.onUpdate(dc) ‚Üí drawFlaggingScreen()
   ‚îî‚îÄ‚Üí Affiche 3 options : Ma√Ætris√© / Connu / Inconnu
10. [Utilisateur navigue avec UP/DOWN et s√©lectionne avec SELECT]
11. LanguageView.submitFlag()
    ‚îú‚îÄ‚Üí QuizModel.setCurrentWordStatus(status)
    ‚îÇ   ‚îî‚îÄ‚Üí VocabularyData.setWordStatus(index, status)
    ‚îÇ       ‚îî‚îÄ‚Üí WordProgressStorage.setWordStatus(index, status)
    ‚îÇ           ‚îî‚îÄ‚Üí Storage.setValue("word_progress", data)
    ‚îî‚îÄ‚Üí nextQuestion()
```

## üíæ Persistance des Donn√©es (v1.3+)

### Vue d'Ensemble

L'application utilise le **Storage API** de Garmin Connect IQ pour sauvegarder de mani√®re persistante le niveau de ma√Ætrise de chaque mot. Ces donn√©es survivent :
- √Ä la fermeture de l'application
- Au red√©marrage de la montre
- Aux mises √† jour de l'application (tant que l'ID ne change pas)

### Flux de Persistance

```
[Utilisateur √©value un mot]
        ‚Üì
LanguageView.submitFlag()
        ‚Üì
QuizModel.setCurrentWordStatus(status)
        ‚Üì
VocabularyData.setWordStatus(index, status)
        ‚Üì
WordProgressStorage.setWordStatus(index, status)
        ‚Üì
Storage.setValue("word_progress", Dictionary)
        ‚Üì
[Sauvegard√© sur la montre]
```

### Structure des Donn√©es Stock√©es

**Format JSON √©quivalent** :
```json
{
  "word_progress": {
    "0": 0,    // Mot index 0 = Ma√Ætris√©
    "1": 1,    // Mot index 1 = Connu
    "5": 2,    // Mot index 5 = Inconnu
    "42": 0,   // Mot index 42 = Ma√Ætris√©
    ...
  }
}
```

**Signification des valeurs** :
- `0` = `STATUS_MASTERED` (‚úì Ma√Ætris√©)
- `1` = `STATUS_KNOWN` (‚óã Connu)
- `2` = `STATUS_UNKNOWN` (‚úó Inconnu)

**Mots non √©valu√©s** : Si un mot n'appara√Æt pas dans le dictionnaire, il est consid√©r√© comme `STATUS_UNKNOWN` par d√©faut.

### Limites du Storage

**Capacit√©s Garmin** :
- Taille maximale : ~100-1000 KB selon les appareils
- Pour 300 mots : ~2-3 KB utilis√©s (tr√®s l√©ger)
- Pas de limite de lecture/√©criture

**Bonnes pratiques** :
- Une seule cl√© de stockage (`"word_progress"`)
- Stockage d'un Dictionary simple (pas d'objets complexes)
- Mise √† jour atomique (remplacement complet du dictionnaire)

### R√©cup√©ration des Donn√©es

Au d√©marrage de l'application, les donn√©es sont automatiquement charg√©es depuis le Storage :

```monkeyc
// Premi√®re fois : Storage retourne null
var data = Storage.getValue("word_progress");
if (data == null) {
    data = {}; // Dictionnaire vide
}

// Ensuite : Storage retourne le Dictionary sauvegard√©
var status = data.get("42"); // R√©cup√®re le statut du mot 42
```

### R√©initialisation des Donn√©es

Pour effacer toute la progression (utile pour un reset) :

```monkeyc
WordProgressStorage.resetAllProgress();
// Efface toutes les donn√©es de progression
```

### Statistiques de Progression

L'application peut calculer des statistiques en temps r√©el :

```monkeyc
var stats = WordProgressStorage.getStatistics();
// Retourne : { "mastered" => X, "known" => Y, "unknown" => Z }

var masteredPercent = WordProgressStorage.getMasteredPercentage();
// Retourne : pourcentage de mots ma√Ætris√©s (0.0 - 100.0)

var evaluatedCount = WordProgressStorage.getEvaluatedWordsCount();
// Retourne : nombre de mots qui ont √©t√© √©valu√©s au moins une fois
```

### Cas d'Usage Avanc√©s

**Filtrer par statut** (future feature) :
```monkeyc
// G√©n√©rer une question uniquement avec des mots "Inconnus"
var unknownWords = [];
for (var i = 0; i < VocabularyData.getVocabularySize(); i++) {
    if (VocabularyData.getWordStatus(i) == WordProgressStorage.STATUS_UNKNOWN) {
        unknownWords.add(i);
    }
}
// Utiliser unknownWords pour le quiz
```

**Tri par difficult√©** (future feature) :
```monkeyc
// Prioriser les mots non ma√Ætris√©s dans la g√©n√©ration des questions
function getWeightedRandomWord() {
    var index = Math.rand() % VocabularyData.getVocabularySize();
    var status = VocabularyData.getWordStatus(index);
    
    // R√©-essayer si le mot est ma√Ætris√© (60% du temps)
    if (status == WordProgressStorage.STATUS_MASTERED && Math.rand() % 100 < 60) {
        return getWeightedRandomWord();
    }
    
    return index;
}
```

### Debugging du Storage

Pour afficher les donn√©es stock√©es en debug :

```monkeyc
// Dans LanguageApp.onStart()
var data = Storage.getValue("word_progress");
if (data != null) {
    System.println("Mots enregistr√©s : " + data.size());
    var keys = data.keys();
    for (var i = 0; i < keys.size(); i++) {
        var index = keys[i];
        var status = data.get(index);
        System.println("Mot " + index + " = " + status);
    }
}
```

## üé® Personnalisation

### √âvaluation des Mots (v1.3+)

**Fonctionnalit√©** : Apr√®s chaque question, l'utilisateur peut √©valuer son niveau de ma√Ætrise du mot.

**Workflow** :
1. L'utilisateur r√©pond √† la question (correcte ou incorrecte)
2. Le feedback s'affiche (vert ou rouge)
3. Message "Appuyez pour √©valuer" appara√Æt
4. L'utilisateur appuie sur SELECT ou tape l'√©cran
5. L'√©cran de flaggage s'affiche avec 3 options :
   - ‚úì **Ma√Ætris√©** (vert) : Je connais parfaitement ce mot
   - ‚óã **Connu** (orange) : Je reconnais ce mot mais je ne suis pas s√ªr
   - ‚úó **Inconnu** (rouge) : Ce mot m'est totalement inconnu
6. L'utilisateur s√©lectionne une option avec UP/DOWN ou en tapant
7. Le statut est enregistr√© et la question suivante s'affiche

**Navigation** :
- **Boutons physiques** : UP/DOWN pour naviguer, SELECT pour valider
- **√âcran tactile** : Taper directement sur l'option souhait√©e

**Persistance** :
- Le statut est **imm√©diatement sauvegard√©** dans le Storage
- Il persiste entre les sessions
- Peut √™tre modifi√© √† chaque nouvelle rencontre du mot

### Affichage du Pinyin (v1.2+)

**Fonctionnalit√©** : L'utilisateur peut cacher/afficher le pinyin pendant le quiz.

**Comment l'utiliser** :
- Appuyer sur le bouton **MENU** pendant le quiz pour basculer l'affichage
- L'√©tat est conserv√© entre les sessions (variable statique)
- Un indicateur `[MENU: Pinyin]` s'affiche quand le pinyin est cach√©

**Comportement** :
```monkeyc
// Mode Normal (Hanzi ‚Üí Fran√ßais)
Pinyin visible: ‰Ω†Â•Ω
               n«ê h«éo

Pinyin cach√©:   ‰Ω†Â•Ω
               [MENU: Pinyin]

// Mode Invers√© (Fran√ßais ‚Üí Hanzi)
Pinyin visible: Bonjour
               (n«ê h«éo)

Pinyin cach√©:   Bonjour
               [MENU: Pinyin]
```

**Impl√©mentation** :
- Variable statique `showPinyin` dans `QuizModel` (conserv√©e entre les quiz)
- M√©thodes `togglePinyin()`, `isPinyinVisible()` pour la gestion
- Rendu conditionnel dans `drawNormalModeQuestion()` et `drawReverseModeQuestion()`
- Zone tactile d√©di√©e dans `handleTapAt()` : les clics dans le haut de l'√©cran (0-35%) basculent le pinyin

### Modifier les Couleurs
Dans `LanguageView.mc` :
```monkeyc
// Changer la couleur de s√©lection
dc.setColor(Graphics.COLOR_DK_BLUE, Graphics.COLOR_DK_BLUE);
// ‚Üí Graphics.COLOR_PURPLE, Graphics.COLOR_PURPLE

// Changer la couleur du feedback correct
dc.setColor(Graphics.COLOR_DK_GREEN, Graphics.COLOR_DK_GREEN);
// ‚Üí Graphics.COLOR_BLUE, Graphics.COLOR_BLUE
```

### Modifier la Taille des Polices
```monkeyc
// Hanzi plus grand
Graphics.FONT_SYSTEM_LARGE
// ‚Üí Graphics.FONT_NUMBER_HOT

// Options plus petites
Graphics.FONT_SYSTEM_TINY
// ‚Üí Graphics.FONT_SYSTEM_XTINY
```

### Ajuster le Layout
Dans `LanguageView.onUpdate()` :
```monkeyc
// Position du hanzi (actuellement 15%)
height * 0.15
// ‚Üí height * 0.10 (plus haut)

// Position des options (actuellement 40%)
var optionStartY = (height * 40) / 100;
// ‚Üí var optionStartY = (height * 45) / 100; (plus bas)
```

### Ajouter des Niveaux HSK Suppl√©mentaires
Dans `VocabularyData.mc` :
```monkeyc
// Ajouter des mots HSK 3
["Âõ†‰∏∫", "yƒ´nw√®i", "parce que", 3],
["ÊâÄ‰ª•", "su«íy«ê", "donc", 3],
// etc.
```

Puis dans `QuizModel.mc`, ajouter un filtre :
```monkeyc
// Nouvelle m√©thode
function setHskFilter(level as Number) as Void {
    // Impl√©menter le filtrage par niveau
}
```

## ‚ö° Optimisation

### M√©moire
**Probl√®me** : Les montres Garmin ont une m√©moire limit√©e (~64-256 KB selon le mod√®le)

**Solutions appliqu√©es** :
1. **Donn√©es statiques** : Utilisation de m√©thodes static dans VocabularyData
2. **Arrays simples** : Pas de dictionnaires gourmands en m√©moire
3. **Historique limit√©** : Seulement 20 derniers mots m√©moris√©s
4. **Pas de caching** : G√©n√©ration √† la vol√©e

**V√©rifier l'utilisation m√©moire** :
```monkeyc
// Ajouter dans LanguageView.initialize()
System.println("Memory: " + System.getSystemStats().usedMemory);
```

### Performance
**Optimisations impl√©ment√©es** :
1. **G√©n√©ration efficace des distracteurs** : Max 10 tentatives pour √©viter les r√©p√©titions
2. **Algorithme Fisher-Yates** : M√©lange optimal en O(n)
3. **Rendu direct** : Pas d'utilisation de layouts XML (overhead)
4. **Redessins minimaux** : Uniquement sur interaction ou changement d'√©tat

### Batterie
**Conseils** :
- L'application n'utilise pas de GPS, capteurs ou connexion ‚Üí impact minimal
- Le backlight consomme le plus : l'utilisateur contr√¥le
- Pas de timers ou de rafra√Æchissements automatiques

## üêõ D√©bogage

### Logs
Ajouter des logs dans le code :
```monkeyc
System.println("Current word index: " + currentWordIndex);
System.println("Selected option: " + selectedOption);
System.println("Score: " + score + "/" + totalQuestions);
```

Visualiser dans VS Code :
```
Output panel ‚Üí Monkey C (nom de la configuration)
```

### Simulateur
Lancer avec d√©bogage :
```bash
# Via VS Code
F5 (ou Run > Start Debugging)

# Via ligne de commande
monkeydo bin/Language.prg fenix847mm
```

**Contr√¥les simulateur** :
- Fl√®ches : Navigation
- Enter : SELECT
- Escape : BACK

### Erreurs Courantes

**1. "Invalid type" lors de la compilation**
```monkeyc
// ‚ùå Mauvais
var height = dc.getHeight() * 0.5; // Float

// ‚úÖ Bon
var height = (dc.getHeight() * 50) / 100; // Number
```

**2. "Undefined symbol"**
```monkeyc
// ‚ùå Variable non d√©clar√©e
centerX = width / 2;

// ‚úÖ D√©claration avec type
var centerX = width / 2;
```

**3. "Symbol not found"**
```monkeyc
// ‚ùå Import manquant
class MyClass extends WatchUi.View {

// ‚úÖ Ajouter l'import
import Toybox.WatchUi;
class MyClass extends WatchUi.View {
```

### Tests Manuels

**Checklist de test** :

**Quiz** :
- [ ] Les caract√®res chinois s'affichent correctement
- [ ] Le pinyin est lisible
- [ ] Navigation UP/DOWN fonctionne dans le quiz
- [ ] S√©lection correcte ‚Üí Fond vert
- [ ] S√©lection incorrecte ‚Üí Fond rouge + correction
- [ ] Score s'incr√©mente correctement
- [ ] Pas de r√©p√©tition imm√©diate des mots
- [ ] Toutes les 4 options sont diff√©rentes
- [ ] Le bouton BACK retourne au menu (v1.1+)
- [ ] Le bouton MENU bascule l'affichage du pinyin (v1.2+)
- [ ] L'√©tat du pinyin est conserv√© entre les questions (v1.2+)
- [ ] L'indicateur `[MENU: Pinyin]` s'affiche quand le pinyin est cach√© (v1.2+)
- [ ] L'√©cran de feedback s'affiche correctement (v1.3+)
- [ ] Le message "Appuyez pour √©valuer" appara√Æt apr√®s le feedback (v1.3+)
- [ ] L'√©cran de flaggage s'affiche avec 3 options (v1.3+)
- [ ] Navigation UP/DOWN fonctionne dans le flaggage (v1.3+)
- [ ] Les couleurs des options de flaggage sont correctes (vert/orange/rouge) (v1.3+)
- [ ] La s√©lection d'un statut enregistre les donn√©es (v1.3+)
- [ ] Les statuts persistent apr√®s fermeture/r√©ouverture de l'app (v1.3+)
- [ ] Les clics tactiles fonctionnent sur les options de flaggage (v1.3+)
- [ ] Le statut peut √™tre modifi√© √† chaque nouvelle rencontre du mot (v1.3+)

**Menu** :
- [ ] Le menu affiche 3 options (Quiz Normal, Quiz Invers√©, Dictionnaire) (v1.4+)
- [ ] Navigation UP/DOWN fonctionne dans le menu (v1.4+)
- [ ] Les clics tactiles fonctionnent sur les 3 options (v1.4+)
- [ ] SELECT lance le mode s√©lectionn√© (v1.4+)
- [ ] BACK quitte l'application (v1.4+)

**Dictionnaire** :
- [ ] La liste des mots s'affiche correctement (v1.4+)
- [ ] Navigation UP/DOWN fonctionne avec scroll (v1.4+)
- [ ] L'indicateur de scroll appara√Æt quand n√©cessaire (v1.4+)
- [ ] Les ic√¥nes de statut (‚úì/‚óã/‚úó) s'affichent correctement (v1.4+)
- [ ] Les couleurs des statuts sont correctes (vert/orange/rouge) (v1.4+)
- [ ] Le filtre MENU cycle correctement (Tous ‚Üí Ma√Ætris√©s ‚Üí Connus ‚Üí Inconnus) (v1.4+)
- [ ] Le compteur de mots s'affiche correctement selon le filtre (v1.4+)
- [ ] La s√©lection d'un mot ouvre les d√©tails (v1.4+)
- [ ] BACK retourne au menu (v1.4+)

**D√©tails du mot** :
- [ ] Toutes les informations s'affichent (hanzi, pinyin, traduction, HSK, statut) (v1.4+)
- [ ] SELECT active le mode √©dition (v1.4+)
- [ ] Tap sur zone "Statut" active le mode √©dition (v1.4+)
- [ ] Tap ailleurs en mode d√©tail ne fait rien (v1.4+)
- [ ] Navigation UP/DOWN fonctionne en mode √©dition (v1.4+)
- [ ] Les 3 options de statut s'affichent avec les bonnes couleurs (v1.4+)
- [ ] SELECT sauvegarde le statut s√©lectionn√© (v1.4+)
- [ ] Tap direct sur une option s√©lectionne et sauvegarde imm√©diatement (v1.4+)
- [ ] BACK annule les modifications en mode √©dition (v1.4+)
- [ ] BACK retourne au dictionnaire en mode d√©tail (v1.4+)
- [ ] Le statut modifi√© est imm√©diatement visible dans le dictionnaire (v1.4+)
- [ ] Le statut modifi√© persiste apr√®s fermeture/r√©ouverture (v1.4+)

## üìö Ressources

### Documentation Garmin
- [Connect IQ SDK](https://developer.garmin.com/connect-iq/overview/)
- [API Reference](https://developer.garmin.com/connect-iq/api-docs/)
- [Monkey C Programming Guide](https://developer.garmin.com/connect-iq/monkey-c/)

### Outils
- [Simulateur Connect IQ](https://developer.garmin.com/connect-iq/connect-iq-basics/getting-started/)
- [VS Code Extension](https://marketplace.visualstudio.com/items?itemName=garmin.monkey-c)

### Vocabulaire HSK
- [HSK Academy](https://www.hskhsk.com/word-lists.html)
- [Chinese-tools.com](https://chinese-tools.com/tools/hsk.html)

---

**Bon d√©veloppement ! üíª**
